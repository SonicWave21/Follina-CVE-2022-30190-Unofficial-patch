@ECHO off
chdir /d %~dp0
cls
color 0a
:banner
:::  _____                    __ _____      _       _     
::: |  __ \                  / _|  __ \    | |     | |    
::: | |__) |___  _   _  __ _| |_| |__) |_ _| |_ ___| |__  
::: |  _  // _ \| | | |/ _` |  _|  ___/ _` | __/ __| '_ \ 
::: | | \ \ (_) | |_| | (_| | | | |  | (_| | || (__| | | |
::: |_|  \_\___/ \__,_|\__, |_| |_|   \__,_|\__\___|_| |_|
:::                     __/ |                             
:::                    |___/                              
for /f "delims=: tokens=*" %%A in ('findstr /b ::: "%~f0"') do @echo(%%A
goto start

:start
ECHO.
NET SESSION >nul 2>&1
IF %ERRORLEVEL% EQU 0 (
    ECHO [+] Access ok
) ELSE (
    ECHO [*] Please run as Administrator
	goto end
)
ECHO 1. Patch Follina CVE-2022-30190
ECHO 2. Restore Follina CVE-2022-30190 (If backup exists)
ECHO 3. Help
ECHO 4. About
ECHO 5. Exit
set choice=
set /p choice= Enter : 
if not '%choice%'=='' set choice=%choice:~0,1%
if '%choice%'=='1' goto Patch
if '%choice%'=='2' goto Restore
if '%choice%'=='3' goto Help
if '%choice%'=='4' goto About
if '%choice%'=='5' goto end
ECHO "%choice%" Please select valid Number [1-5]
ECHO.
goto start

:Patch
cls
ECHO [+] Checking for Backup file @ %~dp0
if exist msdtregbak.reg (
   ECHO [*] What are you doing...?
) else (
    ECHO [+] Ok.
)
ECHO [+] Generating Backup file @ %~dp0msdtregbak.reg
reg export HKEY_CLASSES_ROOT\ms-msdt msdtregbak.reg
ECHO [+] Export Complete.
ECHO [+] Removing ms-msdt from Reg.
reg delete HKEY_CLASSES_ROOT\ms-msdt /f
ECHO [+] Done
goto start

:Restore
cls
ECHO [+] Checking for backup file...?
if exist msdtregbak.reg (
   ECHO [+] Found Backup.
   reg import msdtregbak.reg
   ECHO [+] Done.
) else (
    ECHO [*] File not Found.
)
goto start

:Help
cls
ECHO [Help]
ECHO Microsoft has listed 41 versions of Windows that are vulnerable to Follina CVE-2022-30190 vulnerability.
ECHO https://msrc-blog.microsoft.com/2022/05/30/guidance-for-cve-2022-30190-microsoft-support-diagnostic-tool-vulnerability/
goto start

:end
cls
pause
Exit

:About
cls
ECHO RoughPatch for Follina CVE-2022-30190
ECHO Its is only Temporary (Unofficial patch)
ECHO By SonicWave21
goto start
